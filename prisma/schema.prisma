// The Ass-istant üçë ‚Äî Dan's personal operating system
// Prisma schema with SQLite

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ============================================================
// PROJECTS ‚Äî The channels/ventures
// ============================================================
model Project {
  id            String   @id @default(cuid())
  name          String
  emoji         String   @default("üìÅ")
  colorHex      String   @default("#888888")
  weight        Float    @default(0)       // 0.0-1.0 channel weight
  isActive      Boolean  @default(true)
  sortOrder     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  goals         Goal[]
  todoItems     TodoItem[]
  transactions  Transaction[]
}

// ============================================================
// GOALS ‚Äî Yearly ‚Üí Monthly hierarchy
// ============================================================
model Goal {
  id            String   @id @default(cuid())
  title         String
  description   String   @default("")
  timeframe     String                     // "yearly", "monthly", "weekly"
  targetDate    DateTime?                  // When this goal should be achieved
  isCompleted   Boolean  @default(false)
  completedAt   DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Hierarchy: yearly goal has monthly children, monthly has weekly children
  parentId      String?
  parent        Goal?    @relation("GoalHierarchy", fields: [parentId], references: [id])
  children      Goal[]   @relation("GoalHierarchy")

  // Relations
  projectId     String
  project       Project  @relation(fields: [projectId], references: [id])
  todoItems     TodoItem[]
}

// ============================================================
// TODO ITEMS ‚Äî The actual tasks, checkable, scorable
// ============================================================
model TodoItem {
  id              String   @id @default(cuid())
  title           String
  date            DateTime
  timeSlot        String   @default("all")    // "am", "pm", "eve", "all"
  isLocked        Boolean  @default(false)     // Bold = committed
  isCompleted     Boolean  @default(false)
  completedAt     DateTime?
  notes           String   @default("")
  isAutoGenerated Boolean  @default(false)     // Auto-populated from goal

  // Scoring
  impact          Int      @default(5)         // 1-10
  ease            Int      @default(5)         // 1-10
  control         Int      @default(10)        // 1-10
  urgency         Int      @default(1)         // 1-3

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  projectId       String?
  project         Project? @relation(fields: [projectId], references: [id])
  goalId          String?
  goal            Goal?    @relation(fields: [goalId], references: [id])
}

// ============================================================
// TRANSACTIONS ‚Äî Money in, money out
// ============================================================
model Transaction {
  id              String   @id @default(cuid())
  title           String
  amount          Float                        // Positive = income, negative = expense
  date            DateTime
  isConfirmed     Boolean  @default(false)
  isRecurring     Boolean  @default(false)
  recurrenceRule  String?                      // "monthly", "biweekly", "weekly"
  recurrenceDay   Int?                         // Day of month or cycle
  category        String   @default("income")  // "income", "bill", "rent", "supplier", "shipping"
  notes           String   @default("")

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  projectId       String?
  project         Project? @relation(fields: [projectId], references: [id])
}

// ============================================================
// SETTINGS ‚Äî App-level config
// ============================================================
model Settings {
  id              String  @id @default("singleton")
  startingBalance Float   @default(0)
  updatedAt       DateTime @updatedAt
}
